<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>STEP2-4.パッケージマネージャのnpmとは / チームラボ オンラインスキルアップ課題</title>
    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>
          <img src="../images/logo.jpg" align="middle">
          チームラボ オンラインスキルアップ課題
        </h1>
      </header>
      <section>
        <div id="side_menu">
          <h2>目次</h2>
          <ul>
            <li><a href="../index.html">はじめに</a>
          </ul>
          <h3>STEP1 TODOリスト（フロントエンド）を作ろう</h3>
          <ul>
            <li><a href="../1/1.html">1.サンプルコードを動かしてみる</a>
            <li><a href="../1/2.html">2.Gitを使ってみる</a>
            <li><a href="../1/3.html">3.JavaScriptを書いてみる</a>
            <li><a href="../1/4.html">4.HTML,CSSを書いてみる</a>
            <li><a href="../1/5.html">5.jQueryを使ってみる</a>
            <li><a href="../1/6.html">6.ローカルストレージを使ってみる</a>
            <li><a href="../1/7.html">7.入力チェックを作ってみる</a>
            <li><a href="../1/8.html">最終課題</a>
          </ul>
          
          <h3>STEP2 TODOリスト（フロントエンド＋サーバサイドバージョン）を作ろう</h3>
          <ul>
            <li><a href="../2/1.html">1.インターネットのしくみ</a>
            <li><a href="../2/2.html">2.HTTPのしくみ</a>
            <li><a href="../2/3.html">3.NodeJSとは</a>
            <li><a href="../2/4.html">4.パッケージマネージャのnpmとは</a>
            <li><a href="../2/5.html">5.npmを使ってexpressをインストールして使ってみる</a>
            <li><a href="../2/6.html">6.MongoDBをインストールして使ってみる</a>
            <li><a href="../2/7.html">7.MongoDBを設計してみる</a>
            <li><a href="../2/8.html">8.ブラウザ（JavaScript）とサーバ（NodeJS）を連携してみる</a>
            <li><a href="../2/9.html">9.画面仕様書を満たす</a>
            <li><a href="../2/10.html">最終課題</a>
          </ul>
          
          <h3>STEP3 オリジナルチャットシステムを作ろう</h3>
          <ul>
            <li><a href="../3/1.html">1.websocketを使ってみる</a>
            <li><a href="../3/2.html">2.画面仕様書,スケジュールを作ってみる</a>
            <li><a href="../3/3.html">3.テストとは</a>
            <li><a href="../3/4.html">4.単体テストを書いてみる</a>
            <li><a href="../3/5.html">5.Herokuとは</a></li>
            <li><a href="../3/6.html">6.Herokuを使って公開してみる</a></li>
            <li><a href="../3/7.html">最終課題</a>
          </ul>
        </div>
        <div id="contents">
          <h1>STEP2-4.パッケージマネージャのnpmとは</h1>

<h3>Node Packaged Modules(npm)とは</h3>

<p><a href="https://www.npmjs.org/">Node Packaged Modules(npm)</a>とはNode.jsのライブラリやパッケージを管理することができるツールです。
ライブラリやパッケージの管理ツールを主に<a href="http://ja.wikipedia.org/wiki/%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0">パッケージマネージャ</a>と呼びます。
パッケージマネージャを使うことで、使いたいライブラリの導入や削除を簡易にしたり、パッケージ同士の依存関係を管理することができます。</p>

<p>Node.jsのパッケージマネージャであるnpmは、Node.jsと一緒にインストールされています。
またnpmでインストールできるパッケージが登録されており、<a href="https://www.npmjs.org/">npmjs.org</a>からどのようなパッケージが管理できるかを確認することができます。</p>

<h3>パッケージマネージャを使ってみる</h3>

<p>コマンドライン上でnpmを使います。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; npm list -g
</code></pre></div>
<p>とコマンドラインで実行すること既にインストールされたパッケージを確認することができます。
「-g」というパラメータはグローバル（PC内のすべてのプロジェクトで使える）のパッケージを指定します。
「-g」を除くとローカル（現在のディレクトリ内）のパッケージの指定になります。</p>

<p>コマンドラインから実行するものはグローバルに、ソースコードの中で読み込むライブラリはローカルにパッケージをインストールするという風にして、「-g」をつけるかどうかの区別を行えばいいです。</p>

<h3>supervisorを使ってみる</h3>

<p>コマンドライン上で実行するコマンドとして<a href="https://www.npmjs.org/package/supervisor">supervisor</a>というパッケージをインストールしてみます。
supervisorはNode.jsのプログラムを監視し、エラーが発生してプログラムが終了した場合に自動に再起動してくれます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">num</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span> <span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Hey, you are No.&#39;</span> <span class="o">+</span> <span class="nx">num</span> <span class="o">+</span> <span class="s1">&#39; user!&#39;</span><span class="p">);</span>
    <span class="nx">num</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// エラーを発生させる</span>
    <span class="k">throw</span> <span class="s2">&quot;exception!&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">1337</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;server running at localhost:1337&#39;</span><span class="p">);</span>
</code></pre></div>
<p>このプログラムを実行すると、アクセスした回数を数えて表示していき10を超えるとエラーメッセージが表示されて終了するはずです。</p>

<blockquote>
<p>※ Chromeでは内部処理によってページアクセス時にfaviconへのアクセスも同時に行わるため、このプログラムではカウントが２ずつ増えます。</p>
</blockquote>

<p>Webサイトとして公開するときはエラーが発生したときに終了してしまうと、毎回手動でサーバを再起動しなければいけません。
SupervisorというNode.jsでプロセスを監視するプログラムを用いて、Webサイトを監視するようにします。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; npm install -g supervisor
</code></pre></div>
<p>このようにコマンドラインで実行することでsupervisorをインストールします。
Supervisorはコマンドライン上で実行するので「-g」を足してグローバルにインストールします。</p>

<p>再度、<code>npm list -g</code> を実行すると、supervisorがインストールされていることがわかります。</p>

<p>この状態でSupervisorを実行します。コマンドは以下のようになり、引数に先ほどのファイルを指定します。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; supervisor server.js
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">Running node-supervisor with
  program &#39;server.js&#39;
  --watch &#39;.&#39;
  --extensions &#39;node,js&#39;
  --exec &#39;node&#39;

Starting child process with &#39;node server.js&#39;
...
server running at localhost:1337
</code></pre></div>
<p>先ほど同じように10を超えた時点で前回と同様にプログラムが停止しますが、
自動的にプログラムを再起動しているのがコマンドプロンプト上で確認することができます。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/Users/xxx/nodeStudy/server.js:11
    throw &quot;exception!&quot;;
    ^
exception!
Program node server.js exited with code 8

Starting child process with &#39;node server.js&#39;
server running at localhost:1337
</code></pre></div>
<p>再度アクセスするとカウントが0からになっており、再起動が行われたことがわかります。</p>

        </div>
      </section>
    </div>
  </body>
</html>
