<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>STEP2-6.MongoDBをインストールして使ってみる / チームラボ オンラインスキルアップ課題</title>
    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>
          <img src="../images/logo.jpg" align="middle">
          チームラボ オンラインスキルアップ課題
        </h1>
      </header>
      <section>
        <div id="side_menu">
          <h2>目次</h2>
          <ul>
            <li><a href="../index.html">はじめに</a>
          </ul>
          <h3>STEP1 ToDoリスト（フロントエンド）を作ろう</h3>
          <ul>
            <li><a href="../1/1.html">1.サンプルコードを動かしてみる</a>
            <li><a href="../1/2.html">2.Gitを使ってみる</a>
            <li><a href="../1/3.html">3.JavaScriptを書いてみる</a>
            <li><a href="../1/4.html">4.HTML,CSSを書いてみる</a>
            <li><a href="../1/5.html">5.jQueryを使ってみる</a>
            <li><a href="../1/6.html">6.ローカルストレージを使ってみる</a>
            <li><a href="../1/7.html">7.入力チェックを作ってみる</a>
            <li><a href="../1/8.html">最終課題</a>
          </ul>
          
          <h3>STEP2 ToDoリスト（フロントエンド＋サーバサイドバージョン）を作ろう</h3>
          <ul>
            <li><a href="../2/1.html">1.インターネットのしくみ</a>
            <li><a href="../2/2.html">2.HTTPのしくみ</a>
            <li><a href="../2/3.html">3.NodeJSとは</a>
            <li><a href="../2/4.html">4.パッケージマネージャのnpmとは</a>
            <li><a href="../2/5.html">5.npmを使ってexpressをインストールして使ってみる</a>
            <li><a href="../2/6.html">6.MongoDBをインストールして使ってみる</a>
            <li><a href="../2/7.html">7.MongoDBを設計してみる</a>
            <li><a href="../2/8.html">8.ブラウザ（JavaScript）とサーバ（NodeJS）を連携してみる</a>
            <li><a href="../2/9.html">9.画面仕様書を満たす</a>
            <li><a href="../2/10.html">最終課題</a>
          </ul>
          
          <h3>STEP3 オリジナルサイトを作ろう</h3>
          <ul>
            <li><a href="../3/1.html">1.websocketを使ってみる</a>
            <li><a href="../3/2.html">2.画面仕様書,スケジュールを作ってみる</a>
            <li><a href="../3/3.html">3.テストとは</a>
            <li><a href="../3/4.html">4.単体テストを書いてみる</a>
            <li><a href="../3/5.html">5.Herokuとは</a></li>
            <li><a href="../3/6.html">6.Herokuを使って公開してみる</a></li>
            <li><a href="../3/7.html">最終課題</a>
          </ul>
        </div>
        <div id="contents">
          <h1>STEP2-6.MongoDBをインストールして使ってみる</h1>

<h3>MongoDBとは</h3>

<p>MongoDBは、データベース機能を提供するサーバーです。
STEP 1ではローカルストレージを使用しましたが、保存先をサーバーにすることで、多数の人とデータを共有し、データを送受信できるようになります。
データベース・サーバーとしてはMySQLやPostgreSQLなどのサーバーがよく知られています。
この2つのサーバーは、データを「テーブル」と呼ばれるExcelシートのような1つの表として保存します。
テーブルはデータベース内に複数定義することができますが、テーブルにデータを挿入したり削除したりする前に、どの列にどのデータを入れるのかをあらかじめ決めておく必要があり、これを「スキーマ設計」と呼びます。
MongoDBもテーブルを作りますが、Excelシートのようにどの列にどのデータを入れるのか事前に決める必要がなく（スキーマレス）、JSON形式のデータを直接保存して検索することができます。</p>

<h3>MongoDBをインストールする</h3>

<p>MongoDBの<a href="http://www.mongodb.org/downloads">ダウンロードページ</a>からダウンロードします。
Windowsへのインストールは<a href="http://kakakikikeke.blogspot.jp/2014/02/windowsmongodb.html">Windowsにmongodbをインストール</a>を参考にしてください。
mongod.exeを実行してMongoDBを起動し、mongo.exeを実行することで起動しているDBに接続できるはずです。</p>

<p>常にサーバを起動するためにはサービスとして登録する必要があります。
Windowsでのサービス登録は<a href="http://totora0155.hatenablog.jp/entry/2013/07/13/032129">WindowsでMongoDBを使えるようにする</a>を参考にしてください。
管理者権限でコマンドプロンプトを実行する必要がありますが、サービスを開始することで毎回MongoDBサーバを起動しなくてもよくなります。</p>

<h3>MongoDBを使ってみる</h3>

<p>MongoDBの使い方は<a href="http://gihyo.jp/dev/serial/01/mongodb/0001?page=3">使ってみようMongoDB</a>や<a href="http://gihyo.jp/dev/serial/01/mongodb/0003?page=1">MongoDBのクエリを使いこなそう</a>が参考になります。</p>

<p>MondoDBでは<a href="http://ja.wikipedia.org/wiki/%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E8%A8%80%E8%AA%9E">クエリ</a>を書いてデータベースの操作を行います。</p>

<p>mongo.exeを実行するとコマンドプロンプト(以下、mongoシェル)の画面が表示され、クエリを実行できるようになります。</p>

<p>試しに、Userデータを1件作ってみましょう。</p>

<p><code>users</code>というオブジェクトにフィールドのキーとして<code>name</code>, <code>age</code>, <code>tag</code>を定義したデータを作成します。
MongoDBのデータは常にキーと値のペアになります。</p>

<p>mongoシェルで以下のMongoクエリを実行すると、userデータに名前は「のび太」、年齢は「25」、特徴は「man,megane,anime」というレコードが生成されます。
（MongoシェルはJavaScriptと同じ構文で記述することができます。）</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; db.users.insert(
  {
    name : &#39;のび太&#39;,
    age : 25,
    tag : [&#39;man&#39;, &#39;megane&#39;, &#39;anime&#39;]
  }
)

WriteResult({ &quot;nInserted&quot;:1 }) #←1件のデータが挿入されたというメッセージが表示される
</code></pre></div>
<p>また、以下のクエリを実行すると、usersに保存されているレコード全て表示することができます。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; db.users.find()
{ &quot;_id&quot;: ObjectId(...), &quot;name&quot;: &#39;のび太&#39;, &quot;age&quot; ... }
</code></pre></div>
<p><code>_id</code>というのはMongoDB上で自動的に付与される識別用の値になります。</p>

<p>クエリはJavaScriptと同じ構文で記述できるので、以下のようなfor文などの制御文も入力することもできます。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">for (var i = 1; i &lt;= 10; i++) {
  db.testData.insert(
    // 0~100のデータをランダムに追加
    { x : Math.ceil( Math.random() * 100 ) }
  )
}
</code></pre></div>
<p>また条件をつけてデータを数えたり検索、削除することができます。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// 全データ数を数える
db.testData.count()

// xが50より大きいデータ数を数える
db.testData.count( { x : { $gt : 50 }} )

// xが50より大きいデータ数を検索
db.testData.find( { x : { $gt : 50 }} )

// xが10より小さいデータを削除
db.testData.remove({ x : {$lt : 10} })
</code></pre></div>
        </div>
      </section>
    </div>
  </body>
</html>
