<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>STEP2-5.npmを使ってexpressをインストールして使ってみる / チームラボ オンラインスキルアップ課題</title>
    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>
          <img src="../images/logo.jpg" align="middle">
          チームラボ オンラインスキルアップ課題
        </h1>
      </header>
      <section>
        <div id="side_menu">
          <h2>目次</h2>
          <ul>
            <li><a href="../index.html">はじめに</a>
          </ul>
          <h3>STEP1 TODOリスト（フロントエンド）を作ろう</h3>
          <ul>
            <li><a href="../1/1.html">1.サンプルコードを動かしてみる</a>
            <li><a href="../1/2.html">2.Gitを使ってみる</a>
            <li><a href="../1/3.html">3.JavaScriptを書いてみる</a>
            <li><a href="../1/4.html">4.HTML,CSSを書いてみる</a>
            <li><a href="../1/5.html">5.jQueryを使ってみる</a>
            <li><a href="../1/6.html">6.ローカルストレージを使ってみる</a>
            <li><a href="../1/7.html">7.入力チェックを作ってみる</a>
            <li><a href="../1/8.html">最終課題</a>
          </ul>
          
          <h3>STEP2 TODOリスト（フロントエンド＋サーバサイドバージョン）を作ろう</h3>
          <ul>
            <li><a href="../2/1.html">1.インターネットのしくみ</a>
            <li><a href="../2/2.html">2.HTTPのしくみ</a>
            <li><a href="../2/3.html">3.NodeJSとは</a>
            <li><a href="../2/4.html">4.パッケージマネージャのnpmとは</a>
            <li><a href="../2/5.html">5.npmを使ってexpressをインストールして使ってみる</a>
            <li><a href="../2/6.html">6.MongoDBをインストールして使ってみる</a>
            <li><a href="../2/7.html">7.MongoDBを設計してみる</a>
            <li><a href="../2/8.html">8.ブラウザ（JavaScript）とサーバ（NodeJS）を連携してみる</a>
            <li><a href="../2/9.html">9.画面仕様書を満たす</a>
            <li><a href="../2/10.html">最終課題</a>
          </ul>
          
          <h3>STEP3 オリジナルサイトを作ろう</h3>
          <ul>
            <li><a href="../3/1.html">1.websocketを使ってみる</a>
            <li><a href="../3/2.html">2.画面仕様書,スケジュールを作ってみる</a>
            <li><a href="../3/3.html">3.テストとは</a>
            <li><a href="../3/4.html">4.単体テストを書いてみる</a>
            <li><a href="../3/5.html">5.Herokuとは</a></li>
            <li><a href="../3/6.html">6.Herokuを使って公開してみる</a></li>
            <li><a href="../3/7.html">最終課題</a>
          </ul>
        </div>
        <div id="contents">
          <h1>STEP2-5.npmを使ってexpressをインストールして使ってみる</h1>

<h3>expressとは</h3>

<p><a href="https://www.npmjs.org/package/express">express</a>とはWebアプリケーションフレームワークと呼ばれるものの１つです。
Webアプリケーションを効率よく作るための雛形や骨組みのようなものです。</p>

<h3>expressのインストールと実行</h3>

<p>npmを利用してexpressをインストールします。
まずexpressのプロジェクトを作成する<a href="https://www.npmjs.org/package/express-generator">express-generator</a>をグローバルにインストールします。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; npm install -g express-generator
</code></pre></div>
<p>そしてプロジェクトを作成します。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; express firstApp
</code></pre></div>
<p>以上を実行すると、firstAppというディレクトリが作成され、その中にexpressのひな形が生成されます。</p>

<p>firstAppディレクトリに移動し、<code>npm install</code>を実行します。<br>
<code>npm install</code>は実行したディレクトリ(ここではfirstApp)内にある<code>package.json</code>の中に記載されているパッケージをインストールします。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; cd firstApp
&gt; npm install
</code></pre></div>
<p>サーバを起動します。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt; npm start
</code></pre></div>
<p>ブラウザでlocalhost:3000にアクセスしてください。
expressが動いていることが確認できるはずです。</p>

<p>ポートが今までの1337ではなく3000になっているのは、expressのデフォルトが3000になっているからです。
ポート番号は他の値に変更することができます。</p>

<h3>expressを使ってみる</h3>

<p>expressの使い方は<a href="http://expressjs.com/guide.html">Getting started</a>や古いバージョンですが日本語訳の<a href="http://hideyukisaito.github.io/expressjs-doc_ja/guide/">ガイド</a>が参考になります。</p>

<p>express実行時の起点となるファイルは同ディレクトリの<code>app.js</code>になります。
中身を見てみると処理の途中でルーティングを行っていることが分かります。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">routes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/index&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/users&#39;</span><span class="p">);</span>

<span class="p">...</span><span class="err">中略</span><span class="p">...</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">routes</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="nx">users</span><span class="p">);</span>
</code></pre></div>
<p>ルーティングとはURLと実行するプログラムを紐付けるもので、上の場合、
「localhost:3000/」にアクセスしたときはroutesディレクトリのindex.jsが、<br>
「localhost:3000/users」にアクセスしたときはroutesディレクトリのusers.jsがそれぞれ実行されます。</p>

<p>次にroutesディレクトリのindex.jsを確認してみます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Express&#39;</span> <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><code>res.render</code>というメソッドでブラウザ上に表示するデータを指定します。
最初の引数の&#39;index&#39;とはviewsディレクトリのindex.jadeを指定しています。</p>

<p>このファイルは<a href="http://jade-lang.com/">Jade</a>で書かれています。
JadeとはHTMLを簡略して書くことができるテンプレートエンジンです。
Jadeについては<a href="https://gist.github.com/japboy/5402844">Jadeとは何か</a>が参考になります。</p>

<p>2番目の引数は、ページに表示する値を設定しており、
以下のように変更することで表示される文字列が変わっていることが確認できます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;FirstApp&#39;</span> <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
        </div>
      </section>
    </div>
  </body>
</html>
